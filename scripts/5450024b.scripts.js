"use strict";angular.module("angulargyanknApp",[]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("angulargyanknApp").controller("MainCtrl",["$scope","gyanken","$timeout","api",function(a,b,c,d){a.myHand=null,a.$watch(function(){var a=d.getUserInfo();return a?a.coin:null},function(b){a.myCoin||(a.myCoin=b)});var e=null;a.main={},a.main.bet=1,a.gyanken=function(){e=null,d.fight(a.myHand,a.main.bet,function(a){e=a}),c(f,1500)},a.setMyHand=function(b){console.log("setMyHand:"+b),a.myHand=b,a.gyanken()},a.logcount=0,a.log=function(){console.log("log"+a.logcount)};var f=function(){return e?(a.enemyHand=e.enemyHand,c(function(){b.fight(),a.result=e.result,a.myCoin=e.coin},1200),void 0):(c(f,1e3),void 0)};a.reset=function(){a.result=null,a.myHand=null,a.enemyHand=null},a.isLoggedIn=null,a.$watch(function(){return d.isLoggedIn()},function(b){a.isLoggedIn=b}),a.login=d.login,a.logout=d.logout}]),angular.module("angulargyanknApp").factory("gyanken",function(){var a=null,b=null;return{setMyHand:function(b){a=b},getMyHand:function(){return a},getEnemyHand:function(){return b},setEnemyHand:function(a){b=a},fight:function(){if(null===a||""===a)return"Err no myHand";if(null===b||""===b)return"Wait";if(a===b)return"Even";switch(a){case"G":if("C"===b)return"Win";break;case"C":if("P"===b)return"Win";break;case"P":if("G"===b)return"Win"}return"Lose"}}}),angular.module("angulargyanknApp").controller("CoinCtrl",function(){}),angular.module("angulargyanknApp").factory("coin",function(){return{}}),angular.module("angulargyanknApp").factory("api",["$rootScope",function(a){var b=null,c=function(c){b=c,g=!0,a.$digest()},d=function(){g=!1,a.$digest()},e=function(){gapi.auth.setToken(null),g=!1},f=function(b,f,g){var h=function(){console.log("oauth get user"),gapi.client.oauth2.userinfo.get().execute(function(b){if(b.code)console.log("oauth get user response NG"),d(),g&&a.$apply(g);else{console.log("oauth get user response OK");var h=gapi.auth.getToken();h.access_token=h.id_token,gapi.auth.setToken(h),gapi.client.billingtest.user.fetch().execute(function(b){b.code?(401===b.code&&(e(),a.$digest()),d(),a.$apply(g)):(c(b),f&&a.$apply(function(){f(b)}))})}})};console.log("authorize"),gapi.auth.authorize({client_id:"528512890343.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile",immediate:b,response_type:"token id_token"},h)},g=null,h="https://billingtest-obieseido.appspot.com/_ah/api";return gapi.client.load("billingtest","v1",function(){console.log("load oauth gapi"),gapi.client.load("oauth2","v2",function(){console.log("loaded oauth gapi"),f(!0)})},h),{getUserInfo:function(){return b},isLoggedIn:function(){return g},login:function(a,b){f(!1,a,b)},logout:function(){e(),window.location.href="https://accounts.google.com/logout"},fight:function(c,d,e){gapi.client.billingtest.game.fight({myHand:c,bet:d}).execute(function(c){b.coin=c.coin,e&&a.$apply(function(){e(c)})})}}}]);